<?xml version="1.0" encoding="UTF-8"?>
<prompt>
    <task>
        分析代码审查评论，提取结构化数据并生成人类可读的总结。
    </task>
    
    <input>
        {{comments}}
    </input>
    
    <output_format>
        请以 JSON 格式返回结果，包含以下两个主要部分：
        1. metrics: 用于记录到 sheet 的结构化数据
        2. summary: 用于发送到 Lark 群组的总结信息
        
        格式如下：
        {
            "metrics": {
                "score": 95,  // 平均分数
                "critical_issues": 2,  // 严重错误数量
                "medium_issues": 3,  // 中度错误数量
                "minor_issues": 1,  // 轻微错误数量
                "critical_reasons": ["原因1", "原因2"],  // 严重错误原因列表
                "dimensions": ["维度1", "维度2"],  // 审查维度列表
                "tags": ["标签1", "标签2"]  // 相关标签列表
            },
            "summary": {
                "file_count": 5,  // 审查文件数量
                "critical_issues": 2,  // 严重问题数量
                "score": 95,  // 代码质量评分
                "critical_problems": [  // 严重问题列表
                    {
                        "file": "文件路径",
                        "description": "问题描述",
                        "impact": "影响说明",
                        "suggestion": "改进建议"
                    }
                ],
                "review": {
                    "can_merge": true,  // 是否可以合并
                    "blocking_issues": ["阻断性问题1", "阻断性问题2"],  // 阻断性问题列表
                    "conclusion": "总体结论"
                }
            }
        }
    </output_format>
    
    <rules>
        1. 从评论中提取所有相关的指标数据
        2. 确保所有数值都是数字类型
        3. 确保所有列表都是数组类型
        4. 如果某个指标没有数据，使用空数组或 0
        5. 总结部分应该包含足够的上下文信息
        6. 严重问题应该包含具体的文件路径和详细描述
        7. 总体结论应该简洁明了
    </rules>
</prompt>